#!/bin/sh

prefix=/usr

while : ; do
  case "$1" in
    "") break;;
    --prefix)
      prefix=$2; shift;;
    *)
      >&2 echo "Unknown option \"$1\".";;
  esac
  shift
done

arch=`cat $prefix/lib/ocaml/Makefile.config | grep '^ARCH' | head -n 1 | sed -e s/ARCH=//g`
case "$arch" in
  "llir_amd64")
    cc="llir_x86_64-unknown-linux-musl-clang"
    ar="llir_x86_64-unknown-linux-musl-ar"
    ranlib="llir_x86_64-unknown-linux-musl-ranlib"
    ;;
  "amd64")
    cc="x86_64-unknown-linux-musl-clang"
    ar="x86_64-linux-gnu-ar"
    ranlib="x86_64-linux-gnu-ranlib"
    ;;
  "llir_arm64")
    cc="llir_aarch64-unknown-linux-musl-clang"
    ar="llir_aarch64-unknown-linux-musl-ar"
    ranlib="llir_aarch64-unknown-linux-musl-ranlib"
    ;;
  "arm64")
    cc="aarch64-unknown-linux-musl-clang"
    ar="aarch64-linux-gnu-ar"
    ranlib="aarch64-linux-gnu-ranlib"
    ;;
  "llir_ppc64")
    cc="llir_ppc64le-unknown-linux-musl-clang"
    ar="llir_ppc64le-unknown-linux-musl-ar"
    ranlib="llir_ppc64le-unknown-linux-musl-ranlib"
    ;;
  "ppc64")
    cc="ppc64le-unknown-linux-musl-clang"
    ar="ppc64le-linux-gnu-ar"
    ranlib="ppc64le-linux-gnu-ranlib"
    ;;
  *)
    ;;
esac

echo "# gmp configuration" > Makefile.config

echo "AR=${ar}" >> Makefile.config
echo "RANLIB=${ranlib}" >> Makefile.config
echo "CC=${cc}" >> Makefile.config
echo "PREFIX=${prefix}" >> Makefile.config
